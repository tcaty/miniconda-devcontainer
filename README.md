# Общая информация

В этом блоке я расскажу, что вообще происходить в контейнере. Данный контейнер представляет собой изолированную среду для проекта, т. е. подразумевается, что 1 контейнер == 1 проект.

Виртуальные окружения:

- `base` - стандартное окружение конды, в него дополнительно ничего не устанавливалось
- `venv` - окружение, в которое устанавливаются все зависимости из `venv/environment.yml`, именно это окружение выбрано в настройках vscode

Рабочая папка:

- `/usr/src` - рабочая папка, за её пределы не рекомендуется выходить, т.к. именно для неё создаётся volume в скрипте `create-devcontainer.sh` (об этом немного позже). <i>Eсли вы можете самостоятельно работать с volume, то замечание выше недейтсвительно)</i>

Для успешной работы с гитом дополнительные действия не требуется, всё происходит за кадром. Ваш гит конфиг на `ML1` == гит конфиг в контейнере. 

Для автоматического форматирования python кода используется [Black](https://github.com/psf/black). Пожалуйста, не забывайте подгружать форматтер в новые ноутбуки, подобно тому, как это сделано в `notebooks/notebook.ipynb`.

# Быстрый старт на ML1

## Предисловие

Примечания:

- Далее будет часто использоваться палитра команд vscode, открыть её можно с помощью комбинации клавиш `Ctrl + Shift + P`
- Условные переменные я буду обозначать как `<переменная>`, например, команда `ls <имя папки пользователя>` должна выглядеть как `ls myusername`
- Выбрать что-то в меню == нажать Enter

Также для дальнейшей работы необходимо установить пак дополнений <i>Remote Development</i> (ms-vscode-remote.vscode-remote-extensionpack)

## Удаленное подключение с помощью vscode

1. Открываем палитру комнад и выбираем пункт `Remote SSH: Open SSH Configuration File`
2. В открывшемся меню выбираем файл ssh config, который хотим отредактировать, желательно выбирать не глобальный, а тот, который лежит в вашем пользователе, например, у меня он находится здесь `/home/tcaty/.ssh/config`
3. Далее вставляем туда следующую конфигурацию

```
Host Q9
    HostName <Q9 ip> 
    User <Ваше имя пользователя, которое используется для подключения к Q9>
    Port 55509
    IdentityFile <Путь до приватного ключа, который используется для поключения к Q9>
    
Host ML1
    HostName <ML1 ip>
    User <Ваше имя пользователя, которое используется для подключения к ML1>
    ProxyJump Q9
    IdentityFile <Путь до приватного ключа, который используется для поключения к ML1>
```

Если при подключении к ML1 используются username и password, то заменяем последнюю строчку у `Host ML1` на:
```
    PubkeyAuthentication no
    PreferredAuthentications password
```

4. Отлично! Теперь мы можем подключиться к `ML1` или `Q9` через vscode. Для этого открываем палитру команд и выбираем пункт `Open SSH: Connect to Host`
5. В появившемся меню выбираем `ML1` и подключаемся к серверу. <br/> <i>Примечание</i>. Если для подключения вы используете username и password, то многие действия будут требовать ввода пароля. Я буду опускать этот момент, вводим пароль всегда, когда потребуется.
6. Если всё прошло успешно, то индикатор в левом нижнем углу будет выглядеть следующим образом. Теперь можно редактировать файлы на сервере прямо через vscode, крутяк же :)

![image](https://user-images.githubusercontent.com/79706809/221412593-b4e90f6a-7075-4dbe-bd9e-a647c3c367ea.png)

7. Чтобы отключиться от сервера, в палитре комнад выбираем `Open SSH: Close Remote Connection`

## Создание контейнера и подключение к нему

Осталось выполнить несколько простых шагов:

1. Создать контейнер с помощью команды `bash /tmp/scripts/create-devcontainer.sh <имя конейтенера>`
2. Запустить его с помощью `docker start <имя контейнера>`
3. В палитре команд выбрать `Dev Containers: Attach to Running Container`
4. В открывшемся меню выбрать нужный контейнер и подключиться к нему. Далее можно спокойно разрабатывать в контейнере)

Замечания:

При использовании скрипта `create-devcontainer.sh` создаётся не только контейнер, но ещё и volume, поэтому для полного удаления всей информации о контейнере лучше воспользоваться командой `bash /tmp/scripts/delete-devcontainer.sh <имя конейтенера>`. Данный скрипт удалит и контейнер и volume.
